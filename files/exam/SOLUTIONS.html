<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>T1</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h2 data-anchor-id="9xxv" id="t1">T1</h2><p data-anchor-id="apvr">P,Q的最大公约数为x0，即gcd（P,Q）=x0（gcd为求最大公约数的函数），并且P*Q/gcd（P,Q）=y0，显然，P*Q=x0*y0 <br>
可以看做P=x0*y0/Q，同时要满足P,Q为正整数，并且gcd（P,Q）=x0</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ge22" style=""><ol class="linenums"><li class="L0"><code class="language-cpp"><span class="com">#include</span><span class="str">&lt;iostream&gt;</span></code></li><li class="L1"><code class="language-cpp"><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span></code></li><li class="L2"><code class="language-cpp"><span class="typ">int</span><span class="pln"> gcd</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> b</span><span class="pun">){</span></code></li><li class="L3"><code class="language-cpp"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> b </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> a </span><span class="pun">:</span><span class="pln"> gcd</span><span class="pun">(</span><span class="pln">b</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">%</span><span class="pln">b</span><span class="pun">);</span></code></li><li class="L4"><code class="language-cpp"><span class="pun">}</span><span class="pln">    </span><span class="com">//用于求a和b的最大公约数</span></code></li><li class="L5"><code class="language-cpp"><span class="typ">int</span><span class="pln"> main</span><span class="pun">(){</span></code></li><li class="L6"><code class="language-cpp"><span class="pln">    </span><span class="typ">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> sum</span><span class="pun">;</span></code></li><li class="L7"><code class="language-cpp"><span class="pln">    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> n </span><span class="pun">&gt;&gt;</span><span class="pln"> m</span><span class="pun">;</span></code></li><li class="L8"><code class="language-cpp"><span class="pln">    sum </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">*</span><span class="pln">m</span><span class="pun">;</span></code></li><li class="L9"><code class="language-cpp"><span class="pln">    </span><span class="typ">int</span><span class="pln"> num </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L0"><code class="language-cpp"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> sum</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span></code></li><li class="L1"><code class="language-cpp"><span class="pln">    </span><span class="pun">{</span></code></li><li class="L2"><code class="language-cpp"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sum </span><span class="pun">%</span><span class="pln"> i </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></code></li><li class="L3"><code class="language-cpp"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L4"><code class="language-cpp"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">gcd</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> sum </span><span class="pun">/</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> n</span><span class="pun">)</span></code></li><li class="L5"><code class="language-cpp"><span class="pln">                num</span><span class="pun">++;</span><span class="pln">    </span><span class="com">//当同时满足P和Q的最大公约数为n时，即P,Q满足条件</span></code></li><li class="L6"><code class="language-cpp"><span class="pln">        </span><span class="pun">}</span><span class="pln">    </span><span class="com">//判断P和Q是否都为整数，并且P*Q=sum=n*m</span></code></li><li class="L7"><code class="language-cpp"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="language-cpp"><span class="pln">    cout </span><span class="pun">&lt;&lt;</span><span class="pln"> num </span><span class="pun">&lt;&lt;</span><span class="pln"> endl</span><span class="pun">;</span></code></li><li class="L9"><code class="language-cpp"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="ev5z" id="t2">T2</h2><p data-anchor-id="057l">我们考虑两个人同时走，就相当于数字三角形。状态转移方程为：</p><p data-anchor-id="81ya">f[i][j][k][l]=max(f[i-1][j][k-1][l],f[i-1][j][k][l-1],f[i][j-1][k-1][l],f[i][j-1][k][l-1])+a[i][j]+a[k][l];</p><p data-anchor-id="7ssq">不过要判断i=k&amp;&amp;j=l的情况。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="8lu5" style=""><ol class="linenums"><li class="L0"><code class="language-CPP"><span class="com">#include</span><span class="str">&lt;cstdio&gt;</span></code></li><li class="L1"><code class="language-CPP"><span class="com">#include</span><span class="str">&lt;algorithm&gt;</span></code></li><li class="L2"><code class="language-CPP"><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span></code></li><li class="L3"><code class="language-CPP"><span class="kwd">struct</span><span class="pln"> point</span><span class="pun">{</span></code></li><li class="L4"><code class="language-CPP"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">,</span><span class="pln">data</span><span class="pun">;</span></code></li><li class="L5"><code class="language-CPP"><span class="pun">}</span><span class="pln">p</span><span class="pun">[</span><span class="lit">100</span><span class="pun">];</span></code></li><li class="L6"><code class="language-CPP"></code></li><li class="L7"><code class="language-CPP"><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln">m</span><span class="pun">,</span><span class="pln">map</span><span class="pun">[</span><span class="lit">11</span><span class="pun">][</span><span class="lit">11</span><span class="pun">],</span><span class="pln">f</span><span class="pun">[</span><span class="lit">11</span><span class="pun">][</span><span class="lit">11</span><span class="pun">][</span><span class="lit">11</span><span class="pun">][</span><span class="lit">11</span><span class="pun">];</span></code></li><li class="L8"><code class="language-CPP"></code></li><li class="L9"><code class="language-CPP"><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(){</span></code></li><li class="L0"><code class="language-CPP"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">,</span><span class="pln">j</span><span class="pun">,</span><span class="pln">k</span><span class="pun">,</span><span class="pln">l</span><span class="pun">;</span></code></li><li class="L1"><code class="language-CPP"><span class="pln">    scanf</span><span class="pun">(</span><span class="str">"%d"</span><span class="pun">,&amp;</span><span class="pln">n</span><span class="pun">);</span></code></li><li class="L2"><code class="language-CPP"><span class="pln">    </span><span class="kwd">while</span><span class="pun">(</span><span class="lit">1</span><span class="pun">){</span></code></li><li class="L3"><code class="language-CPP"><span class="pln">        </span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln">b</span><span class="pun">,</span><span class="pln">c</span><span class="pun">;</span></code></li><li class="L4"><code class="language-CPP"><span class="pln">        scanf</span><span class="pun">(</span><span class="str">"%d%d%d"</span><span class="pun">,&amp;</span><span class="pln">a</span><span class="pun">,&amp;</span><span class="pln">b</span><span class="pun">,&amp;</span><span class="pln">c</span><span class="pun">);</span></code></li><li class="L5"><code class="language-CPP"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">a</span><span class="pun">&amp;&amp;!</span><span class="pln">b</span><span class="pun">&amp;&amp;!</span><span class="pln">c</span><span class="pun">)</span></code></li><li class="L6"><code class="language-CPP"><span class="pln">            </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L7"><code class="language-CPP"><span class="pln">        p</span><span class="pun">[++</span><span class="pln">m</span><span class="pun">].</span><span class="pln">x</span><span class="pun">=</span><span class="pln">a</span><span class="pun">;</span></code></li><li class="L8"><code class="language-CPP"><span class="pln">        p</span><span class="pun">[</span><span class="pln">m</span><span class="pun">].</span><span class="pln">y</span><span class="pun">=</span><span class="pln">b</span><span class="pun">;</span></code></li><li class="L9"><code class="language-CPP"><span class="pln">        p</span><span class="pun">[</span><span class="pln">m</span><span class="pun">].</span><span class="pln">data</span><span class="pun">=</span><span class="pln">c</span><span class="pun">;</span></code></li><li class="L0"><code class="language-CPP"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code class="language-CPP"><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="pln">i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">m</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span></code></li><li class="L2"><code class="language-CPP"><span class="pln">        map</span><span class="pun">[</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">x</span><span class="pun">][</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">y</span><span class="pun">]=</span><span class="pln">p</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">data</span><span class="pun">;</span></code></li><li class="L3"><code class="language-CPP"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code class="language-CPP"><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="pln">i</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span></code></li><li class="L5"><code class="language-CPP"><span class="pln">        </span><span class="kwd">for</span><span class="pun">(</span><span class="pln">j</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++){</span></code></li><li class="L6"><code class="language-CPP"><span class="pln">            </span><span class="kwd">for</span><span class="pun">(</span><span class="pln">k</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span><span class="pln">k</span><span class="pun">&lt;=</span><span class="pln">n</span><span class="pun">;</span><span class="pln">k</span><span class="pun">++){</span></code></li><li class="L7"><code class="language-CPP"><span class="pln">                l</span><span class="pun">=</span><span class="pln">i</span><span class="pun">+</span><span class="pln">j</span><span class="pun">-</span><span class="pln">k</span><span class="pun">;</span></code></li><li class="L8"><code class="language-CPP"><span class="pln">                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">l</span><span class="pun">&lt;=</span><span class="lit">0</span><span class="pun">)</span></code></li><li class="L9"><code class="language-CPP"><span class="pln">                    </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L0"><code class="language-CPP"><span class="pln">                f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">k</span><span class="pun">][</span><span class="pln">l</span><span class="pun">]=</span><span class="pln">max</span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">k</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">l</span><span class="pun">],</span><span class="pln">max</span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">k</span><span class="pun">][</span><span class="pln">l</span><span class="pun">-</span><span class="lit">1</span><span class="pun">],</span><span class="pln">max</span><span class="pun">(</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">k</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">l</span><span class="pun">],</span><span class="pln">f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">-</span><span class="lit">1</span><span class="pun">][</span><span class="pln">k</span><span class="pun">][</span><span class="pln">l</span><span class="pun">-</span><span class="lit">1</span><span class="pun">])));</span></code></li><li class="L1"><code class="language-CPP"><span class="pln">                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i</span><span class="pun">==</span><span class="pln">k</span><span class="pun">&amp;&amp;</span><span class="pln">j</span><span class="pun">==</span><span class="pln">l</span><span class="pun">){</span><span class="pln"> </span></code></li><li class="L2"><code class="language-CPP"><span class="pln">                    f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">k</span><span class="pun">][</span><span class="pln">l</span><span class="pun">]+=</span><span class="pln">map</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">];</span></code></li><li class="L3"><code class="language-CPP"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L4"><code class="language-CPP"><span class="pln">                </span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L5"><code class="language-CPP"><span class="pln">                    f</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">][</span><span class="pln">k</span><span class="pun">][</span><span class="pln">l</span><span class="pun">]+=</span><span class="pln">map</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]+</span><span class="pln">map</span><span class="pun">[</span><span class="pln">k</span><span class="pun">][</span><span class="pln">l</span><span class="pun">];</span></code></li><li class="L6"><code class="language-CPP"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L7"><code class="language-CPP"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L8"><code class="language-CPP"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9"><code class="language-CPP"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0"><code class="language-CPP"><span class="pln">    printf</span><span class="pun">(</span><span class="str">"%d\n"</span><span class="pun">,</span><span class="pln">f</span><span class="pun">[</span><span class="pln">n</span><span class="pun">][</span><span class="pln">n</span><span class="pun">][</span><span class="pln">n</span><span class="pun">][</span><span class="pln">n</span><span class="pun">]);</span></code></li><li class="L1"><code class="language-CPP"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L2"><code class="language-CPP"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="atqz">T3 <br>
题解：两个单调队列，一个维护区间内最小值，一个在区间内维护最大值，就可以得到可以涂的轮廓线；（自己画图）</p><p data-anchor-id="1qf4">遇到高度不一样或长度不够则要多一个刷子；</p><p data-anchor-id="ll7s">单调对列求区间最大用递减队列；</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="r6af" style=""><ol class="linenums"><li class="L0"><code class="language-cpp"><span class="com">#include</span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span></code></li><li class="L1"><code class="language-cpp"><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span></code></li><li class="L2"><code class="language-cpp"><span class="com">#define</span><span class="pln"> ll </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span></code></li><li class="L3"><code class="language-cpp"><span class="kwd">const</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> M </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e6</span><span class="pun">+</span><span class="lit">10</span><span class="pun">;</span></code></li><li class="L4"><code class="language-cpp"><span class="kwd">struct</span><span class="pln"> </span><span class="typ">Queue</span><span class="pun">{</span></code></li><li class="L5"><code class="language-cpp"><span class="pln">    </span><span class="typ">int</span><span class="pln"> id</span><span class="pun">;</span><span class="pln"> ll h</span><span class="pun">;</span></code></li><li class="L6"><code class="language-cpp"><span class="pun">}</span><span class="pln">q</span><span class="pun">[</span><span class="pln">M</span><span class="pun">],</span><span class="pln"> q2</span><span class="pun">[</span><span class="pln">M</span><span class="pun">],</span><span class="pln"> q3</span><span class="pun">[</span><span class="pln">M</span><span class="pun">];</span></code></li><li class="L7"><code class="language-cpp"></code></li><li class="L8"><code class="language-cpp"><span class="pln">ll a</span><span class="pun">[</span><span class="pln">M</span><span class="pun">],</span><span class="pln"> lim</span><span class="pun">[</span><span class="pln">M</span><span class="pun">];</span></code></li><li class="L9"><code class="language-cpp"></code></li><li class="L0"><code class="language-cpp"><span class="typ">int</span><span class="pln"> main</span><span class="pun">(){</span></code></li><li class="L1"><code class="language-cpp"><span class="pln">    </span><span class="typ">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> ll ret </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L2"><code class="language-cpp"><span class="pln">    scanf</span><span class="pun">(</span><span class="str">"%d%d"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">m</span><span class="pun">);</span></code></li><li class="L3"><code class="language-cpp"><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">scanf</span><span class="pun">(</span><span class="str">"%lld"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span></code></li><li class="L4"><code class="language-cpp"><span class="pln">    </span><span class="typ">int</span><span class="pln"> h </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L5"><code class="language-cpp"><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L6"><code class="language-cpp"><span class="pln">        </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">h </span><span class="pun">&lt;=</span><span class="pln"> t </span><span class="pun">&amp;&amp;</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">t</span><span class="pun">].</span><span class="pln">h </span><span class="pun">&gt;=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">t</span><span class="pun">--;</span></code></li><li class="L7"><code class="language-cpp"><span class="pln">        q</span><span class="pun">[++</span><span class="pln">t</span><span class="pun">].</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">t</span><span class="pun">].</span><span class="pln">h </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></code></li><li class="L8"><code class="language-cpp"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;=</span><span class="pln"> m</span><span class="pun">){</span></code></li><li class="L9"><code class="language-cpp"><span class="pln">            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">q</span><span class="pun">[</span><span class="pln">h</span><span class="pun">].</span><span class="pln">id </span><span class="pun">&lt;=</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> m</span><span class="pun">)</span><span class="pln">h</span><span class="pun">++;</span></code></li><li class="L0"><code class="language-cpp"><span class="pln">            q2</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">h </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">h</span><span class="pun">].</span><span class="pln">h</span><span class="pun">;</span><span class="pln"> q2</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> q</span><span class="pun">[</span><span class="pln">h</span><span class="pun">].</span><span class="pln">id</span><span class="pun">;</span></code></li><li class="L1"><code class="language-cpp"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L2"><code class="language-cpp"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code class="language-cpp"><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">q2</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> q2</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">h </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1e8</span><span class="pun">;</span></code></li><li class="L4"><code class="language-cpp"><span class="pln">    h </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L5"><code class="language-cpp"><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L6"><code class="language-cpp"><span class="pln">        </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">h </span><span class="pun">&lt;=</span><span class="pln"> t </span><span class="pun">&amp;&amp;</span><span class="pln"> q3</span><span class="pun">[</span><span class="pln">t</span><span class="pun">].</span><span class="pln">h </span><span class="pun">&lt;=</span><span class="pln"> q2</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">h</span><span class="pun">)</span><span class="pln">t</span><span class="pun">--;</span></code></li><li class="L7"><code class="language-cpp"><span class="pln">        q3</span><span class="pun">[++</span><span class="pln">t</span><span class="pun">].</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> q3</span><span class="pun">[</span><span class="pln">t</span><span class="pun">].</span><span class="pln">h </span><span class="pun">=</span><span class="pln"> q2</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">h</span><span class="pun">;</span></code></li><li class="L8"><code class="language-cpp"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;=</span><span class="pln"> m</span><span class="pun">){</span></code></li><li class="L9"><code class="language-cpp"><span class="pln">            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">q3</span><span class="pun">[</span><span class="pln">h</span><span class="pun">].</span><span class="pln">id </span><span class="pun">&lt;=</span><span class="pln"> i </span><span class="pun">-</span><span class="pln"> m</span><span class="pun">)</span><span class="pln">h</span><span class="pun">++;</span></code></li><li class="L0"><code class="language-cpp"><span class="pln">            lim</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> q3</span><span class="pun">[</span><span class="pln">h</span><span class="pun">].</span><span class="pln">h</span><span class="pun">;</span></code></li><li class="L1"><code class="language-cpp"><span class="pln">            ret </span><span class="pun">+=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> lim</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span></code></li><li class="L2"><code class="language-cpp"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3"><code class="language-cpp"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code class="language-cpp"><span class="pln">    ll tt </span><span class="pun">=</span><span class="pln"> q2</span><span class="pun">[</span><span class="pln">n</span><span class="pun">].</span><span class="pln">h</span><span class="pun">;</span></code></li><li class="L5"><code class="language-cpp"><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> m </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">--){</span></code></li><li class="L6"><code class="language-cpp"><span class="pln">        tt </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">tt</span><span class="pun">,</span><span class="pln"> q2</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">h</span><span class="pun">);</span></code></li><li class="L7"><code class="language-cpp"><span class="pln">        lim</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> tt</span><span class="pun">;</span></code></li><li class="L8"><code class="language-cpp"><span class="pln">        ret </span><span class="pun">+=</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> lim</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></code></li><li class="L9"><code class="language-cpp"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0"><code class="language-cpp"><span class="pln">    </span><span class="com">//for(int i = 1; i &lt;= n; i++)printf("%d ", lim[i]);</span></code></li><li class="L1"><code class="language-cpp"><span class="pln">    </span><span class="typ">int</span><span class="pln"> lst </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L2"><code class="language-cpp"><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="typ">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L3"><code class="language-cpp"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> lst </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> m </span><span class="pun">||</span><span class="pln"> lim</span><span class="pun">[</span><span class="pln">lst</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> lim</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]){</span></code></li><li class="L4"><code class="language-cpp"><span class="pln">            lst </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln"> cnt</span><span class="pun">++;</span></code></li><li class="L5"><code class="language-cpp"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L6"><code class="language-cpp"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code class="language-cpp"><span class="pln">    printf</span><span class="pun">(</span><span class="str">"%lld\n%d\n"</span><span class="pun">,</span><span class="pln"> ret</span><span class="pun">,</span><span class="pln"> cnt</span><span class="pun">);</span></code></li><li class="L8"><code class="language-cpp"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="ragk" id="t4">T4</h2><p data-anchor-id="pdo3">题解：值域线段树</p><p data-anchor-id="0eud">一个树与其他树距离和：他离开头的距离<em>在他前面树的个数 - 前面树离开头距离总和 + 他离结尾的距离</em>在他后面树的个数 - 后面树离结尾距离总和；用值域线段树记录前面树的个数距离，log（N)求一棵树离其他树的距离，总复杂度Nlog(N);</p><p data-anchor-id="3il2">注意到处都要mod， 还要防止减成负数，还有nd-&gt;zuo = (nd-&gt;zuo + pos) % mod; 不能直接赋值成位置，因为有多个树，这个地方wa了很久</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ugss" style=""><ol class="linenums"><li class="L0"><code><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span></code></li><li class="L1"><code><span class="com">#define</span><span class="pln"> ll </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span></code></li><li class="L2"><code><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span></code></li><li class="L3"><code><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> M </span><span class="pun">=</span><span class="pln"> </span><span class="lit">200005</span><span class="pun">;</span></code></li><li class="L4"><code><span class="kwd">const</span><span class="pln"> ll mod </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000000007</span><span class="pun">;</span></code></li><li class="L5"><code><span class="kwd">int</span><span class="pln"> cnt</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">ll dis</span><span class="pun">[</span><span class="pln">M</span><span class="pun">],</span><span class="pln"> tmp</span><span class="pun">[</span><span class="pln">M</span><span class="pun">];</span></code></li><li class="L7"><code><span class="pln">ll ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L8"><code><span class="kwd">struct</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">    ll zuo</span><span class="pun">,</span><span class="pln"> you</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">int</span><span class="pln"> zz</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="typ">Node</span><span class="pln"> </span><span class="pun">*</span><span class="pln">ls</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*</span><span class="pln">rs</span><span class="pun">;</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">void</span><span class="pln"> up</span><span class="pun">(){</span></code></li><li class="L4"><code><span class="pln">        zuo </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ls</span><span class="pun">-&gt;</span><span class="pln">zuo </span><span class="pun">+</span><span class="pln"> rs</span><span class="pun">-&gt;</span><span class="pln">zuo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">        you </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ls</span><span class="pun">-&gt;</span><span class="pln">you </span><span class="pun">+</span><span class="pln"> rs</span><span class="pun">-&gt;</span><span class="pln">you</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">        zz </span><span class="pun">=</span><span class="pln"> ls</span><span class="pun">-&gt;</span><span class="pln">zz </span><span class="pun">+</span><span class="pln"> rs</span><span class="pun">-&gt;</span><span class="pln">zz</span><span class="pun">;</span></code></li><li class="L7"><code><span class="pln">        </span><span class="com">//yy = ls-&gt;yy + rs-&gt;yy;</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pun">}</span><span class="pln">pool</span><span class="pun">[</span><span class="pln">M</span><span class="pun">&lt;&lt;</span><span class="lit">2</span><span class="pun">],</span><span class="pln"> </span><span class="pun">*</span><span class="pln">root</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*</span><span class="pln">tail </span><span class="pun">=</span><span class="pln"> pool</span><span class="pun">;</span></code></li><li class="L0"><code><span class="typ">Node</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> build</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">){</span></code></li><li class="L1"><code><span class="pln">    </span><span class="typ">Node</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> nd </span><span class="pun">=</span><span class="pln"> </span><span class="pun">++</span><span class="pln">tail</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">)</span><span class="pln">nd</span><span class="pun">-&gt;</span><span class="pln">zuo </span><span class="pun">=</span><span class="pln"> nd</span><span class="pun">-&gt;</span><span class="pln">you </span><span class="pun">=</span><span class="pln"> nd</span><span class="pun">-&gt;</span><span class="pln">zz </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">        nd</span><span class="pun">-&gt;</span><span class="pln">ls </span><span class="pun">=</span><span class="pln"> build</span><span class="pun">(</span><span class="pln">l</span><span class="pun">,</span><span class="pln"> mid</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">        nd</span><span class="pun">-&gt;</span><span class="pln">rs </span><span class="pun">=</span><span class="pln"> build</span><span class="pun">(</span><span class="pln">mid</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">        nd</span><span class="pun">-&gt;</span><span class="pln">up</span><span class="pun">();</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> nd</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pun">}</span></code></li><li class="L1"><code><span class="com">#define</span><span class="pln"> </span><span class="typ">Ls</span><span class="pln"> nd</span><span class="pun">-&gt;</span><span class="pln">ls</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> mid</span></code></li><li class="L2"><code><span class="com">#define</span><span class="pln"> </span><span class="typ">Rs</span><span class="pln"> nd</span><span class="pun">-&gt;</span><span class="pln">rs</span><span class="pun">,</span><span class="pln"> mid</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> r</span></code></li><li class="L3"><code><span class="pln">ll query1</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> L</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> R</span><span class="pun">,</span><span class="pln">  </span><span class="typ">Node</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> nd </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">){</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">L </span><span class="pun">&lt;=</span><span class="pln"> l </span><span class="pun">&amp;&amp;</span><span class="pln"> R </span><span class="pun">&gt;=</span><span class="pln"> r</span><span class="pun">){</span></code></li><li class="L5"><code><span class="pln">        cnt </span><span class="pun">+=</span><span class="pln"> nd</span><span class="pun">-&gt;</span><span class="pln">zz</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> nd</span><span class="pun">-&gt;</span><span class="pln">zuo</span><span class="pun">;</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pln">    ll ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">L </span><span class="pun">&lt;=</span><span class="pln"> mid</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> query1</span><span class="pun">(</span><span class="pln">L</span><span class="pun">,</span><span class="pln"> R</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Ls</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">R </span><span class="pun">&gt;</span><span class="pln"> mid</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans</span><span class="pun">+</span><span class="pln"> query1</span><span class="pun">(</span><span class="pln">L</span><span class="pun">,</span><span class="pln"> R</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Rs</span><span class="pun">))</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> ans</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pun">}</span></code></li><li class="L4"><code><span class="pln">ll query2</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> L</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> R</span><span class="pun">,</span><span class="pln">  </span><span class="typ">Node</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> nd </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">){</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">L </span><span class="pun">&lt;=</span><span class="pln"> l </span><span class="pun">&amp;&amp;</span><span class="pln"> R </span><span class="pun">&gt;=</span><span class="pln"> r</span><span class="pun">){</span></code></li><li class="L6"><code><span class="pln">        cnt </span><span class="pun">+=</span><span class="pln"> nd</span><span class="pun">-&gt;</span><span class="pln">zz</span><span class="pun">;</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> nd</span><span class="pun">-&gt;</span><span class="pln">you</span><span class="pun">;</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    ll ans </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">L </span><span class="pun">&lt;=</span><span class="pln"> mid</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> query2</span><span class="pun">(</span><span class="pln">L</span><span class="pun">,</span><span class="pln"> R</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Ls</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">R </span><span class="pun">&gt;</span><span class="pln"> mid</span><span class="pun">)</span><span class="pln"> ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans</span><span class="pun">+</span><span class="pln"> query2</span><span class="pun">(</span><span class="pln">L</span><span class="pun">,</span><span class="pln"> R</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Rs</span><span class="pun">))</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> ans</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pun">}</span></code></li><li class="L5"><code><span class="kwd">void</span><span class="pln"> insert</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> pos</span><span class="pun">,</span><span class="pln"> ll d2</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Node</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> nd </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">){</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">l </span><span class="pun">==</span><span class="pln"> r</span><span class="pun">){</span></code></li><li class="L7"><code><span class="pln">        nd</span><span class="pun">-&gt;</span><span class="pln">zz </span><span class="pun">++;</span></code></li><li class="L8"><code><span class="pln">        nd</span><span class="pun">-&gt;</span><span class="pln">zuo </span><span class="pun">=</span><span class="pln"> dis</span><span class="pun">[</span><span class="pln">pos</span><span class="pun">];</span></code></li><li class="L9"><code><span class="pln">        nd</span><span class="pun">-&gt;</span><span class="pln">you </span><span class="pun">=</span><span class="pln"> d2</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">int</span><span class="pln"> mid </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">l </span><span class="pun">+</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">pos </span><span class="pun">&lt;=</span><span class="pln"> mid</span><span class="pun">)</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">pos</span><span class="pun">,</span><span class="pln"> d2</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Ls</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">else</span><span class="pln"> insert</span><span class="pun">(</span><span class="pln">pos</span><span class="pun">,</span><span class="pln"> d2</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Rs</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        nd</span><span class="pun">-&gt;</span><span class="pln">up</span><span class="pun">();</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pun">}</span></code></li><li class="L8"><code><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span></code></li><li class="L9"><code><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">    ll L</span><span class="pun">,</span><span class="pln"> A</span><span class="pun">,</span><span class="pln"> B</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    scanf</span><span class="pun">(</span><span class="str">"%d%lld%lld%lld%lld"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">L</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">dis</span><span class="pun">[</span><span class="lit">1</span><span class="pun">],</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">A</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">B</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">    dis</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%=</span><span class="pln"> L</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">    tmp</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> dis</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">tmp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> dis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]*</span><span class="pln">A</span><span class="pun">+</span><span class="pln">B</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> L</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">   </span><span class="com">// cout&lt;&lt;"OO";</span></code></li><li class="L7"><code><span class="pln">    sort</span><span class="pun">(</span><span class="pln">tmp</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> tmp</span><span class="pun">+</span><span class="lit">1</span><span class="pun">+</span><span class="pln">n</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">    m </span><span class="pun">=</span><span class="pln"> unique</span><span class="pun">(</span><span class="pln">tmp</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> tmp</span><span class="pun">+</span><span class="lit">1</span><span class="pun">+</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> tmp </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pln">    root </span><span class="pun">=</span><span class="pln"> build</span><span class="pun">();</span></code></li><li class="L0"><code><span class="pln">  </span><span class="com">//  cout&lt;&lt;"h1"&lt;&lt;endl;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">int</span><span class="pln"> pos </span><span class="pun">=</span><span class="pln"> lower_bound</span><span class="pun">(</span><span class="pln">tmp</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> tmp</span><span class="pun">+</span><span class="lit">1</span><span class="pun">+</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> dis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> tmp</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">        ll here </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">        cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">        ll a1 </span><span class="pun">=</span><span class="pln"> query1</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> pos</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">     </span><span class="com">//   cout&lt;&lt;"L";</span></code></li><li class="L7"><code><span class="pln">        here </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1LL</span><span class="pun">*</span><span class="pln">cnt</span><span class="pun">*</span><span class="pln">dis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod </span><span class="pun">-</span><span class="pln"> a1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mod </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span></code></li><li class="L8"><code><span class="pln">        cnt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pln">        ll a2 </span><span class="pun">=</span><span class="pln"> query2</span><span class="pun">(</span><span class="pln">pos</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    </span><span class="com">//    cout&lt;&lt;"KK";</span></code></li><li class="L1"><code><span class="pln">        ll dd </span><span class="pun">=</span><span class="pln"> tmp</span><span class="pun">[</span><span class="pln">m</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> dis</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></code></li><li class="L2"><code><span class="pln">        here </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">here </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1LL</span><span class="pun">*</span><span class="pln">cnt</span><span class="pun">*</span><span class="pln">dd</span><span class="pun">%</span><span class="pln">mod </span><span class="pun">-</span><span class="pln"> a2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mod </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">        </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">here </span><span class="pun">&amp;&amp;</span><span class="pln"> i </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">here </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">        insert</span><span class="pun">(</span><span class="pln">pos</span><span class="pun">,</span><span class="pln"> dd</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        ans </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ans </span><span class="pun">*</span><span class="pln"> here</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> mod</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">        </span><span class="com">//cout&lt;&lt;ans&lt;&lt;endl;</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">    printf</span><span class="pun">(</span><span class="str">"%lld\n"</span><span class="pun">,</span><span class="pln"> ans</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pun">}</span></code></li></ol></pre></div>
</body>
</html>